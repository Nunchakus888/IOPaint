<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å±æ–‡å­—æ°´å°æ•ˆæœ 1:1è¿˜åŸ</title>
    <style>
        /* åŸºç¡€é‡ç½® */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* ç¦æ­¢æ»šåŠ¨ */
            background-color: #000; /* è¦æ±‚ï¼šé»‘åº• */
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        /* æ ¸å¿ƒå®¹å™¨ï¼šç”¨äºæ”¾ç½®æ°´å°æ–‡å­—å†…å®¹ */
        #watermark-container {
            position: fixed;
            top: 50%;
            left: 50%;
            /* å°ºå¯¸ç”± JS æ ¹æ®åŸå›¾åŠ¨æ€è®¡ç®— */
            transform: translate(-50%, -50%);
            
            /* Flex å¸ƒå±€å¤„ç†è¡Œ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            
            /* é¿å…é¼ æ ‡äº¤äº’å½±å“ */
            pointer-events: none;
            user-select: none;
            z-index: 9999;
        }

        /* æ¯ä¸€è¡Œçš„æ ·å¼ */
        .wm-row {
            display: flex;
            width: 100%;
            justify-content: center; /* ç¡®ä¿ç›¸åŒå†…å®¹çš„è¡Œåœ¨ç«–ç›´æ–¹å‘è§†è§‰å¯¹é½ */
            white-space: nowrap;
            box-sizing: border-box;
        }

        /* æ–‡å­—åŸºç¡€æ ·å¼ */
        .wm-text-item {
            color: #e68edd;
            display: inline-flex;
            align-items: center;
        }

        /* èƒŒæ™¯åŸå›¾å±‚ - ç”¨äºå¯¹æ¯” */
        #background-image {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* 1:1 åŸå§‹æ¯”ä¾‹ï¼Œä¸ç¼©æ”¾ */
            width: auto;
            height: auto;
            z-index: 1;
            cursor: move;
        }

        /* è°ƒè¯•é¢æ¿ */
        #debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 10px 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
            user-select: none;
            line-height: 1.6;
        }
        #debug-panel kbd {
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            margin: 0 2px;
        }
    </style>
</head>
<body>

    <!-- è°ƒè¯•é¢æ¿ -->
    <div id="debug-panel">
        <div>ğŸ“ åç§»: <span id="offset-display">X: 0, Y: 0</span></div>
        <div>ğŸ” é€æ˜åº¦: <span id="opacity-display">100%</span></div>
        <hr style="border-color: #333; margin: 6px 0;">
        <div><kbd>æ‹–æ‹½</kbd> ç§»åŠ¨åŸå›¾</div>
        <div><kbd>â†‘</kbd><kbd>â†“</kbd> è°ƒæ•´é€æ˜åº¦</div>
        <div><kbd>R</kbd> é‡ç½®ä½ç½®</div>
        <div><kbd>H</kbd> éšè—/æ˜¾ç¤ºåŸå›¾</div>
    </div>

    <!-- åŸå›¾èƒŒæ™¯å±‚ -->
    <img id="background-image" src="./input.jpg" alt="åŸå›¾å¯¹æ¯”">
    
    <!-- æ°´å°å±‚ -->
    <div id="watermark-container"></div>

    <script>
        /**
         * é…ç½®åŒºåŸŸ - æ”¯æŒ 1:1 è¿˜åŸçš„æ•°å€¼è°ƒæ•´
         */
        const config = {
            // æ•´ä½“è§’åº¦ï¼Œé€†æ—¶é’ˆæ—‹è½¬ä½¿ç”¨è´Ÿæ•° (-25åº¦)
            rotateAngle: -25, 
            
            // åŸºç¡€å­—ä½“å¤§å° (px)
            fontSize: 22,

            // å­—ä½“æ ˆï¼šä¼˜å…ˆè‹¹æ–¹å’Œå¾®è½¯é›…é»‘ï¼Œ1:1è¿˜åŸé»‘ä½“è´¨æ„Ÿ
            fontFamily: '-apple-system, "PingFang SC", "Microsoft YaHei", "Helvetica Neue", Arial, sans-serif',

            // CSSé¢œè‰² (æ”¯æŒ rgba é€æ˜åº¦)
            // color: 'rgba(255, 255, 255, 1)',
            color: 'pink',

            // è¡Œä¸è¡Œä¹‹é—´çš„å‚ç›´é—´è· (px)ï¼Œçº¦ä¸ºå­—å·çš„ 3.5 å€
            rowGap: 30, 

            // åŒä¸€è¡Œå†…ï¼Œé‡å¤æ–‡å­—ç»„ä¹‹é—´çš„æ°´å¹³é—´è· (px)
            // çº¦ä¸ºä¸¤ä¸ªå­—çš„å®½åº¦ï¼ˆfontSize * 2ï¼‰
            colGap: 48,

            // ========== å†…å®¹å®šä¹‰ï¼ˆæ•°ç»„é…ç½®ï¼‰==========
            // æ¯è¡Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ç»„æˆä¸€ä¸ªå®Œæ•´çš„æ°´å°å•å…ƒ
            // æ°´å°å•å…ƒå†…å„ part ä¹‹é—´ä½¿ç”¨ marginLeft æ§åˆ¶é—´è·
            // æ°´å°å•å…ƒä¹‹é—´ä½¿ç”¨ colGap éš”å¼€
            
            // ç¬¬ä¸€è¡Œï¼šé›ªç¥¨ã€é…’åº—...
            contentRow1: [
                { text: "é›ªç¥¨ã€é…’åº—ã€æ•™ç»ƒã€æ‘„å½±å¸ˆã€çº¦ç©", fontSize: 24, fontWeight: 500 }
            ],
            
            // ç¬¬äºŒè¡Œï¼šæ»‘å‘— app 1000ä¸‡é›ªå‹çš„é€‰æ‹©
            contentRow2: [
                { text: "æ»‘å‘—", fontSize: 30, fontWeight: 900 },
                { text: "app", fontSize: 24, fontWeight: 500, marginLeft: 4 },
                { text: "1000ä¸‡é›ªå‹çš„é€‰æ‹©", fontSize: 24, fontWeight: 500, marginLeft: 4 }
            ]
        };

        /**
         * æ ¸å¿ƒæ¸²æŸ“é€»è¾‘
         */
        function initWatermark(imgWidth, imgHeight) {
            const container = document.getElementById('watermark-container');
            
            // 1. æ ¹æ®åŸå›¾å°ºå¯¸å’Œæ—‹è½¬è§’åº¦è®¡ç®—æœ€å°å®¹å™¨å°ºå¯¸
            // æ—‹è½¬åè¦è¦†ç›–åŸå›¾ï¼Œå®¹å™¨éœ€è¦çš„æœ€å°å°ºå¯¸ï¼š
            // containerW = imgW * |cos(Î¸)| + imgH * |sin(Î¸)|
            // containerH = imgW * |sin(Î¸)| + imgH * |cos(Î¸)|
            const angleRad = Math.abs(config.rotateAngle) * Math.PI / 180;
            const cosA = Math.cos(angleRad);
            const sinA = Math.sin(angleRad);
            
            const containerWidth = Math.ceil(imgWidth * cosA + imgHeight * sinA);
            const containerHeight = Math.ceil(imgWidth * sinA + imgHeight * cosA);
            
            // è®¾ç½®å®¹å™¨å°ºå¯¸
            container.style.width = containerWidth + 'px';
            container.style.height = containerHeight + 'px';
            
            // 2. åº”ç”¨æ—‹è½¬è§’åº¦
            container.style.transform = `translate(-50%, -50%) rotate(${config.rotateAngle}deg)`;

            // 3. æ ¹æ®å®¹å™¨å°ºå¯¸è®¡ç®—è¡Œæ•°å’Œåˆ—æ•°
            const rowHeight = config.fontSize + config.rowGap;
            const estimatedRows = Math.ceil(containerHeight / rowHeight) + 2; // +2 ç¡®ä¿è¾¹ç¼˜è¦†ç›–
            
            // ä¼°ç®—æ¯è¡Œé‡å¤æ¬¡æ•°
            const estimatedItemWidth = 300 + config.colGap; // å¤§è‡´ä¼°ç®—å•ä¸ªæ–‡å­—ç»„å®½åº¦
            const repeatCount = Math.ceil(containerWidth / estimatedItemWidth) + 2; 

            // 4. è®¡ç®—å‚ç›´å¯¹é½æ‰€éœ€çš„æ°´å¹³åç§»
            // æ—‹è½¬åï¼Œä¸ºäº†è®©ç›¸åŒå†…å®¹çš„è¡Œåœ¨è§†è§‰ä¸Šå‚ç›´å¯¹é½ï¼Œ
            // æ¯è¡Œéœ€è¦å‘å·¦åç§» y * tan(angle) çš„è·ç¦»
            const tanAngle = Math.tan(angleRad);

            // 5. åŸºç¡€æ ·å¼ï¼ˆå­—ä½“æŠ—é”¯é½¿ï¼‰
            const baseStyle = `
                font-family: ${config.fontFamily};
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            `;

            // 6. æ ¹æ®æ•°ç»„é…ç½®æ„å»ºæ°´å°å•å…ƒ HTML
            function buildItemHtml(parts) {
                const partsHtml = parts.map(part => 
                    `<span style="
                        font-size: ${part.fontSize || config.fontSize}px;
                        font-weight: ${part.fontWeight || 400};
                        margin-left: ${part.marginLeft || 0}px;
                    ">${part.text}</span>`
                ).join('');
                
                return `
                    <div class="wm-text-item" style="
                        ${baseStyle}
                        color: ${config.color};
                        display: inline-flex;
                        align-items: baseline;
                    ">
                        ${partsHtml}
                    </div>
                `;
            }

            const itemHtml1 = buildItemHtml(config.contentRow1);
            const itemHtml2 = buildItemHtml(config.contentRow2);

            // 7. å¾ªç¯ç”Ÿæˆ DOM
            let finalHtml = '';
            // ä»¥ä¸­é—´è¡Œä¸ºåŸºå‡†ï¼Œè®¡ç®—ç›¸å¯¹åç§»
            const centerRow = Math.floor(estimatedRows / 2);

            for (let r = 0; r < estimatedRows; r++) {
                // åˆ¤æ–­å¥‡å¶è¡Œæ¥å†³å®šå†…å®¹
                const isRow1 = r % 2 === 0;
                const contentUnit = isRow1 ? itemHtml1 : itemHtml2;
                
                // ç”Ÿæˆä¸€æ•´è¡Œçš„é‡å¤å†…å®¹
                let rowInnerHtml = '';
                for (let c = 0; c < repeatCount; c++) {
                    rowInnerHtml += contentUnit;
                }

                // è®¡ç®—è¯¥è¡Œç›¸å¯¹äºä¸­å¿ƒè¡Œçš„å‚ç›´è·ç¦»ï¼Œç„¶åè®¡ç®—æ°´å¹³åç§»
                // y å‘ä¸‹ä¸ºæ­£ï¼Œéœ€è¦å‘å·¦åç§»ï¼ˆè´Ÿæ–¹å‘ï¼‰
                const yOffset = (r - centerRow) * rowHeight;
                const xShift = -yOffset * tanAngle;

                // åŒ…è£…è¡Œï¼Œåº”ç”¨æ°´å¹³åç§»å’Œåˆ—é—´è·
                finalHtml += `
                    <div class="wm-row" style="
                        margin-bottom: ${config.rowGap}px;
                        transform: translateX(${xShift}px);
                        gap: ${config.colGap}px;
                    ">
                        ${rowInnerHtml}
                    </div>
                `;
            }

            // å†™å…¥å®¹å™¨
            container.innerHTML = finalHtml;
        }

        // åˆå§‹åŒ–ï¼šç­‰å¾…å›¾ç‰‡åŠ è½½å®Œæˆåè·å–å°ºå¯¸
        const bgImage = document.getElementById('background-image');
        
        function startWatermark() {
            const imgWidth = bgImage.naturalWidth;
            const imgHeight = bgImage.naturalHeight;
            initWatermark(imgWidth, imgHeight);
        }
        
        if (bgImage.complete) {
            startWatermark();
        } else {
            bgImage.addEventListener('load', startWatermark);
        }

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(startWatermark, 300);
        });

        // ========== åŸå›¾æ‹–æ‹½äº¤äº’ ==========
        const offsetDisplay = document.getElementById('offset-display');
        const opacityDisplay = document.getElementById('opacity-display');
        
        let offsetX = 0;
        let offsetY = 0;
        let opacity = 1;
        let isDragging = false;
        let startX, startY;

        // æ›´æ–°åŸå›¾ä½ç½®
        function updateImagePosition() {
            bgImage.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;
            offsetDisplay.textContent = `X: ${offsetX}, Y: ${offsetY}`;
        }

        // æ›´æ–°é€æ˜åº¦
        function updateOpacity() {
            bgImage.style.opacity = opacity;
            opacityDisplay.textContent = `${Math.round(opacity * 100)}%`;
        }

        // é¼ æ ‡æŒ‰ä¸‹
        bgImage.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX - offsetX;
            startY = e.clientY - offsetY;
            bgImage.style.cursor = 'grabbing';
            e.preventDefault();
        });

        // é¼ æ ‡ç§»åŠ¨
        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            offsetX = e.clientX - startX;
            offsetY = e.clientY - startY;
            updateImagePosition();
        });

        // é¼ æ ‡é‡Šæ”¾
        document.addEventListener('mouseup', () => {
            isDragging = false;
            bgImage.style.cursor = 'move';
        });

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            
            // R: é‡ç½®ä½ç½®
            if (key === 'r') {
                offsetX = 0;
                offsetY = 0;
                updateImagePosition();
            }
            
            // H: éšè—/æ˜¾ç¤ºåŸå›¾
            if (key === 'h') {
                bgImage.style.display = bgImage.style.display === 'none' ? 'block' : 'none';
            }
            
            // ä¸Šä¸‹ç®­å¤´: è°ƒæ•´é€æ˜åº¦
            if (e.key === 'ArrowUp') {
                opacity = Math.min(1, opacity + 0.1);
                updateOpacity();
                e.preventDefault();
            }
            if (e.key === 'ArrowDown') {
                opacity = Math.max(0, opacity - 0.1);
                updateOpacity();
                e.preventDefault();
            }
            
            // æ–¹å‘é”®å¾®è°ƒä½ç½® (Shift + æ–¹å‘é”®)
            if (e.shiftKey) {
                const step = 1;
                if (e.key === 'ArrowLeft') { offsetX -= step; updateImagePosition(); }
                if (e.key === 'ArrowRight') { offsetX += step; updateImagePosition(); }
            }
        });
    </script>
</body>
</html>